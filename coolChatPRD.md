# ðŸ“˜ Product Requirements Document (PRD) for **coolChat**

## 1. Vision & Goals

coolChat is a lightweight, Python-based LLM client inspired by **SillyTavern**, but optimized for:

* **Lower memory usage** (Python backend + efficient front-end).
* **Extensibility via plugins** (tools, backgrounds, integrations).
* **Cross-platform usability** (desktop, web-first design).
* **User focus**: Chat roleplay, productivity, tool integration, modularity.

---

## 2. Current State (as observed)
* **âœ… Tool Calling**: Fully implemented with retry mechanisms, schema validation, and async handling for phone_url, image_request, lore_suggestions.
* **âœ… Database Integration**: SQLite backend with migration from JSON files completed.
* **âœ… Chat System**: Persistent conversations, multiple LLM integrations (OpenAI, Gemini, Pollinations, Dezgo), history management.
* **âœ… Theming**: Flexible theme system with presets (Default, Dark, Light, Forest, Ocean, Rose), export/import.
* **âœ… Lorebook System**: Backend fully implemented with CRUD operations, advanced search; UI components exist but need completion.
* **âœ… Character Management**: Import/export JSON/PNG, AI-powered suggestions.
* **âœ… Extensions Support**: Plugin architecture with animatedBackgrounds example.
* **âœ… Debug System**: Comprehensive logging with runtime configuration.
* **âœ… Test Suites**: Backend tests for chat flow, characters, lore, memory.

* **Architecture**:
  * Python backend (FastAPI with routers for chat, lore, characters).
  * Frontend: React + Vite with Zustand state management, TypeScript hooks.
  * Plugins system with manifest-based extensions.

* **Features implemented**:
  * Advanced chat interface with tool integration.
  * Image generation (Dezgo, Pollinations).
  * Responsive UI with state management.
  * Persistent data storage (SQLite).

* **Gaps vs. SillyTavern**:
  * ~~Lorebook UI completion~~ â†’ **COMPLETED** with prompt manager scope expansion.
  * ~~Multi-chat/group bots capability.~~ â†’ **DE-PRIORITIZED**
  * ~~Streaming responses and WebSocket real-time features.~~ â†’ **DE-PRIORITIZED**
  * Advanced RAG/vector search integration.

---

## 3. Key Issues & Bugs (Partially Resolved)

1. **âœ… Tool calling resolved**

   * Fully implemented with retry mechanisms, schema validation, and async handling.
   * Working tool types: phone_url, image_request, lore_suggestions.

2. **Plugin architecture is skeletal**

   * Animated background works, but no plugin manager / hot reload.
   * Risk of plugin breakage on update.

3. **UI/UX improvements needed**

   * **âœ… Session management and persistent history**: Implemented via SQLite backend.
   * **âœ… Character creation/import**: CRUD operations fully functional.
   * Still needs: lorebook UI completion, multi-chat support, responsive design polish.

---

## 4. Feature Requirements (Parity with SillyTavern)

### Core Features

* âœ… **Chat with LLMs** (OpenAI, local backends, API endpoints).
* âœ… **Character cards** (import/export JSON, PNG-embedded metadata).
* ðŸ”¶ **World Info / Lorebooks**: structured knowledge injection (backend implemented, UI needs completion).
* ðŸ”² **Group chats**: multiple bots + user.
* ðŸ”² **Session management**: save/load conversations.
* ðŸ”² **Memory persistence**: long-term context caching.

### Tooling

* âœ… **Tool calling** (robust implementation with schema validation and retry mechanisms).
* ðŸ”¶ **Plugins framework** (hot-load, enable/disable - base architecture exists, needs management UI).
* ðŸ”² **RAG integration** (local embeddings + vector DB for memory).

### Media Features

* ðŸ”² **TTS/STT integration** (whisper, Coqui, or external APIs).
* ðŸ”² **Image gen APIs** (Pollinations, Dezgo, NanoGPT, or external APIs).
   - User customizable external APIs. User's should be able to provide a JSON file that will be read by the app to configure any customer API image generation provider. Many providers use different API schemas so different settings will need configured for each API. Feel free to use DEZGO and pollinations as examples. Create the config JSON files for those two providers based on how they are currently coded.
* ðŸ”² **Background customization** This should be accomplished through plugins exclusively.  The native app should just have a basic background color from the theme. But the backgroundAnimations plugin should add the layered background animations we've been workign on. Future plugins could enable background images generated by the AI, videos, music visualizers, etc.

### Performance

* ~~ðŸ”² **Streaming responses** (token-by-token).~~ streaming is not necessary for the initial release of the app. I feel it will add too much complexity at this time.
* ðŸ”² **Low-memory mode** (offload context to disk).
* ðŸ”² **Smart Context Management** Use multiple strategies to manage large context chats. Utilize RAG, lorebooks and/or other methods to be as token efficient as possible while retaining all the important chat context.
* ðŸ”² **Async concurrency** for tool calls + LLM responses.
   - This needs to be toggleable though as some users and LLM APIs may not allow for multiple calls at once.

---

## 5. Roadmap / Phases

### **Phase 1: Stabilization (Weeks 1â€“2)**

* Fix **tool calling** endpoint:

  * Standardize schema (`name`, `arguments`, `id`).
  * Add logging for failures.
  * Unit test with mock tools.
* Add **persistent conversation storage** (SQLite or JSON).
* Document plugin API clearly.

### **Phase 2: Feature Parity MVP (Weeks 3â€“5)**

* Implement **character card import/export**.
* Add **World Info / lorebook injection**.
* ~~Support multi-chat / group bots.~~ **DE-PRIORITIZED**
* ~~Add streaming responses.~~ **DE-PRIORITIZED**
* Introduce **Prompt Manager & Circuits System**: Flowchart-based UI for prompt management with if/then/else blocks, random choices, OR/XOR/NOR, counters, variables.

### **Phase 3: Expansion (Weeks 6â€“8)**

* **Plugin manager** with UI toggle.
* **RAG memory** via sentence-transformers + FAISS/Chroma.
* **Image gen + TTS** hooks.

### **Phase 4: Polish (Weeks 9â€“12)**

* Improved UI (React or lightweight Vue).
* Themes + animated backgrounds.
* Performance testing: optimize memory footprint.
* Documentation: usage, API, dev guide.

---

## 6. Technical Requirements

* **Backend**: Python (FastAPI preferred for async).
* **Frontend**: Vanilla JS (upgradeable to React).
* **Storage**: SQLite (lightweight, portable).
* **Embeddings**: sentence-transformers (all-MiniLM-L6-v2).
* **Plugins**: JSON manifest + Python/JS handlers.

---

## 7. Acceptance Criteria

* Tool calling works with at least 3 sample tools (math, search, local file lookup).
* Character cards can be imported/exported and used in conversation.
* Lorebook system fully functional (keywords with spaces, search without 422 errors, improved UI).
* Lorebook injects text when keywords triggered.
* Conversations persist across reload.
* Plugins can be enabled/disabled without code edits.

---

## 8. Risks & Mitigation

* **Memory creep**: mitigate by offloading context to disk + streaming.
* **Plugin instability**: enforce schema validation.
* **Frontend sprawl**: keep UI minimal first, expand later.

---

âš¡ **Next Step Recommendation**:
Focus on **Prompt Manager & Circuits System**: Develop the flowchart-based UI for comprehensive prompt and logic management. Ensure all prompt injection systems (lorebooks, character fields, variables) are thoroughly tested and made editable. Position this as the foundation for all AI interactions, preceding work on plugins and RAG to build a robust prompt management layer.

---

